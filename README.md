# Quiner

This python script to gives a basic C program the ability to self reproduce! This is an automation I wrote based on code samples from David Madore's [article](http://www.madore.org/~david/computers/quine.html) on quines. Quines are often obfuscated by the strange syntax necessary to create them. This is in part due to that quines are generally designed to be as short as possible. This can make it difficult to understand them. The goal of the type of code that Quiner generates is to illustrate how quines work. 

The fundamental idea is that the way self reproducing programs work can be compared to the mitosis of cells. Cells are able to keep a record of their own DNA and use it to make copies of themselves. 

## How Does Quiner Work?

Quiner reads the input file into a string where it uses RegEx to pick out the content from main(). It restructures main() to accept a command line argument "q." This gives the generated program the ability to be run as it was originally intended when no arguments are supplied. When the "q" command line argument is supplied, the program simply outputs its source to stdout. The code sample bellow shows how the input program is changed.

```
-- replace main() with this structure --

int main( int argc, char *argv[] ) {
    if ( argc == 2 && *argv[1] == 'q'  ) {
        {c_quine_section}
    } else {
        {c_program_section}
    }
    return 0;
}
```
The part that actually makes the program self reproduce is kept in two sections: the c_quine_section (referenced above) and the data section (shown below). The data section is placed at the top of the file. It is an array of bytes that represent the characters in the file itself. This data section can be thought of as the DNA.
```
-- append to top of file --

const unsigned char data[] = {
/* 000000 */  0x23,  0x69,  0x6e,  0x63,  0x6c,  0x75,  0x64,  0x65,
    ...
/* 0x01d8 */  0x30,  0x3b,  0x0a,  0x7d,
};
```
The c_quine_section is responsible for printing out the file source to stdout. It starts with the DNA, the data byte array. Then it uses the data byte array to print out the actual source. Thus copying over the data it needs to recreate itself along with the functional C source code.
```
printf("const unsigned char data[] = {");

unsigned int i;
for (i = 0; i < sizeof(data); i++) {
    if (i % 8 == 0) {
        printf("\n/* %0#6x */", i);
    }
    printf("  %0#4x,", data[i]);
}

printf("\n};\n\n");

for (i = 0; i < sizeof(data); i++) {
    putchar(data[i]);
}
```

## C File Requirements
* File must have main() function that takes no parameters
* Use as is, there are a lot of restrictions with this design and currently it has only been tested on hello.c

## Usage
```
python quiner.py <file_name>
```

## Example
Turn a simple hello world program written in C into a self reproducing program.

### Input File: hello.c
```
#include <stdio.h>

int main ()
{
    printf("Hello world!\n");
    return 0;
}
```

### Run Quiner
```
python quiner.py hello.c > hello-quine.c
```

### Output: hello-quine.c
Note: Generated code format was manually cleaned up slightly to make it look pretty for the example.
```
const unsigned char data[] = {
/* 000000 */  0x23,  0x69,  0x6e,  0x63,  0x6c,  0x75,  0x64,  0x65,
/* 0x0008 */  0x20,  0x3c,  0x73,  0x74,  0x64,  0x69,  0x6f,  0x2e,
/* 0x0010 */  0x68,  0x3e,  0x0a,  0x0a,  0x69,  0x6e,  0x74,  0x20,
/* 0x0018 */  0x6d,  0x61,  0x69,  0x6e,  0x28,  0x20,  0x69,  0x6e,
/* 0x0020 */  0x74,  0x20,  0x61,  0x72,  0x67,  0x63,  0x2c,  0x20,
/* 0x0028 */  0x63,  0x68,  0x61,  0x72,  0x20,  0x2a,  0x61,  0x72,
/* 0x0030 */  0x67,  0x76,  0x5b,  0x5d,  0x20,  0x29,  0x7b,  0x0a,
/* 0x0038 */  0x69,  0x66,  0x20,  0x28,  0x20,  0x61,  0x72,  0x67,
/* 0x0040 */  0x63,  0x20,  0x3d,  0x3d,  0x20,  0x32,  0x20,  0x26,
/* 0x0048 */  0x26,  0x20,  0x2a,  0x61,  0x72,  0x67,  0x76,  0x5b,
/* 0x0050 */  0x31,  0x5d,  0x20,  0x3d,  0x3d,  0x20,  0x27,  0x71,
/* 0x0058 */  0x27,  0x29,  0x20,  0x7b,  0x0a,  0x20,  0x20,  0x20,
/* 0x0060 */  0x20,  0x20,  0x20,  0x20,  0x20,  0x0a,  0x70,  0x72,
/* 0x0068 */  0x69,  0x6e,  0x74,  0x66,  0x20,  0x28,  0x22,  0x63,
/* 0x0070 */  0x6f,  0x6e,  0x73,  0x74,  0x20,  0x75,  0x6e,  0x73,
/* 0x0078 */  0x69,  0x67,  0x6e,  0x65,  0x64,  0x20,  0x63,  0x68,
/* 0x0080 */  0x61,  0x72,  0x20,  0x64,  0x61,  0x74,  0x61,  0x5b,
/* 0x0088 */  0x5d,  0x20,  0x3d,  0x20,  0x7b,  0x22,  0x29,  0x3b,
/* 0x0090 */  0x0a,  0x0a,  0x75,  0x6e,  0x73,  0x69,  0x67,  0x6e,
/* 0x0098 */  0x65,  0x64,  0x20,  0x69,  0x6e,  0x74,  0x20,  0x69,
/* 0x00a0 */  0x3b,  0x0a,  0x66,  0x6f,  0x72,  0x20,  0x28,  0x20,
/* 0x00a8 */  0x69,  0x3d,  0x30,  0x20,  0x3b,  0x20,  0x69,  0x3c,
/* 0x00b0 */  0x73,  0x69,  0x7a,  0x65,  0x6f,  0x66,  0x28,  0x64,
/* 0x00b8 */  0x61,  0x74,  0x61,  0x29,  0x20,  0x3b,  0x20,  0x69,
/* 0x00c0 */  0x2b,  0x2b,  0x20,  0x29,  0x20,  0x7b,  0x0a,  0x20,
/* 0x00c8 */  0x20,  0x20,  0x20,  0x69,  0x66,  0x20,  0x28,  0x20,
/* 0x00d0 */  0x69,  0x25,  0x38,  0x20,  0x3d,  0x3d,  0x20,  0x30,
/* 0x00d8 */  0x20,  0x29,  0x20,  0x7b,  0x0a,  0x20,  0x20,  0x20,
/* 0x00e0 */  0x20,  0x20,  0x20,  0x20,  0x20,  0x70,  0x72,  0x69,
/* 0x00e8 */  0x6e,  0x74,  0x66,  0x20,  0x28,  0x22,  0x5c,  0x6e,
/* 0x00f0 */  0x2f,  0x2a,  0x20,  0x25,  0x30,  0x23,  0x36,  0x78,
/* 0x00f8 */  0x20,  0x2a,  0x2f,  0x22,  0x2c,  0x69,  0x29,  0x3b,
/* 0x0100 */  0x0a,  0x20,  0x20,  0x20,  0x20,  0x7d,  0x0a,  0x20,
/* 0x0108 */  0x20,  0x20,  0x20,  0x70,  0x72,  0x69,  0x6e,  0x74,
/* 0x0110 */  0x66,  0x20,  0x28,  0x22,  0x20,  0x20,  0x25,  0x30,
/* 0x0118 */  0x23,  0x34,  0x78,  0x2c,  0x22,  0x2c,  0x20,  0x64,
/* 0x0120 */  0x61,  0x74,  0x61,  0x5b,  0x69,  0x5d,  0x29,  0x3b,
/* 0x0128 */  0x0a,  0x7d,  0x0a,  0x20,  0x20,  0x20,  0x20,  0x0a,
/* 0x0130 */  0x70,  0x72,  0x69,  0x6e,  0x74,  0x66,  0x20,  0x28,
/* 0x0138 */  0x22,  0x5c,  0x6e,  0x7d,  0x3b,  0x5c,  0x6e,  0x5c,
/* 0x0140 */  0x6e,  0x22,  0x29,  0x3b,  0x0a,  0x66,  0x6f,  0x72,
/* 0x0148 */  0x20,  0x28,  0x20,  0x69,  0x3d,  0x30,  0x20,  0x3b,
/* 0x0150 */  0x20,  0x69,  0x3c,  0x73,  0x69,  0x7a,  0x65,  0x6f,
/* 0x0158 */  0x66,  0x28,  0x64,  0x61,  0x74,  0x61,  0x29,  0x20,
/* 0x0160 */  0x3b,  0x20,  0x69,  0x2b,  0x2b,  0x20,  0x29,  0x20,
/* 0x0168 */  0x7b,  0x0a,  0x20,  0x20,  0x20,  0x20,  0x70,  0x75,
/* 0x0170 */  0x74,  0x63,  0x68,  0x61,  0x72,  0x20,  0x28,  0x64,
/* 0x0178 */  0x61,  0x74,  0x61,  0x5b,  0x69,  0x5d,  0x29,  0x3b,
/* 0x0180 */  0x0a,  0x7d,  0x0a,  0x0a,  0x20,  0x20,  0x20,  0x20,
/* 0x0188 */  0x7d,  0x20,  0x65,  0x6c,  0x73,  0x65,  0x20,  0x7b,
/* 0x0190 */  0x0a,  0x20,  0x20,  0x20,  0x20,  0x20,  0x20,  0x20,
/* 0x0198 */  0x20,  0x0a,  0x20,  0x20,  0x20,  0x20,  0x70,  0x72,
/* 0x01a0 */  0x69,  0x6e,  0x74,  0x66,  0x28,  0x22,  0x48,  0x65,
/* 0x01a8 */  0x6c,  0x6c,  0x6f,  0x20,  0x77,  0x6f,  0x72,  0x6c,
/* 0x01b0 */  0x64,  0x21,  0x5c,  0x6e,  0x22,  0x29,  0x3b,  0x0a,
/* 0x01b8 */  0x20,  0x20,  0x20,  0x20,  0x72,  0x65,  0x74,  0x75,
/* 0x01c0 */  0x72,  0x6e,  0x20,  0x30,  0x3b,  0x0a,  0x0a,  0x20,
/* 0x01c8 */  0x20,  0x20,  0x20,  0x7d,  0x0a,  0x20,  0x20,  0x20,
/* 0x01d0 */  0x20,  0x72,  0x65,  0x74,  0x75,  0x72,  0x6e,  0x20,
/* 0x01d8 */  0x30,  0x3b,  0x0a,  0x7d,
};

#include <stdio.h>

int main(int argc, char *argv[]) {

    if (argc == 2 && *argv[1] == 'q') {

        printf("const unsigned char data[] = {");

        unsigned int i;
        for (i = 0; i < sizeof(data); i++) {
            if (i % 8 == 0) {
                printf("\n/* %0#6x */", i);
            }
            printf("  %0#4x,", data[i]);
        }

        printf("\n};\n\n");

        for (i = 0; i < sizeof(data); i++) {
            putchar(data[i]);
        }
    }
    else {
        printf("Hello world!\n");
        return 0;
    }
    return 0;
}
```